<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="">
    <link rel="stylesheet" href="css/quizStyle.css">

    <title> Desafio do Cosmos </title> 
</head>

<body onload="mostrarQuiz()">

    <!-- Nessa pagina vai contar toda a interatividade do usuario com o site, ou SEJA
    1. Quiz
    2. Analytics
    3. Calculo Matematico -->

    <div class="containerUsuario">
        <div class="conteudoPainel">
            <div class="painel">

                <div class="hello">
                    <a href="../public/dashboard/dashboard.html"><button class="voltar">VOLTAR</button></a> <br>
                </div>

                <h1 id="titulo" class="titulo">Desafio do Cosmos</h1>

                <div class="botoes">
                    <a href="quiz.html"><button class="quiz">WormHole</button></a> <br>
                </div>

            </div>


            <div class="conteudoQuiz">
                <!-- titulo do quiz -->
                <!-- pergunta do quiz -->
                <div id="pergunta" class="pergunta"></div>
                <p id="resultado"></p>
                <div id="opcoes" class="opcoes">
                </div>
            </div>
        </div>
    </div>

</body>

</html>

<script>

    // arrays que armazenam as perguntas
    var perguntas = [
        {
            pergunta: "Quais são as três leis de Newton?",
            opcoes: ["ART 8, ART 7, ART 6", " Lei da Inércia, Princípio Fundamental da Dinâmica e Lei da Ação e Reação", " Lei da Inércia, Lei da termodinamica e Lei da Ação e Reação", "Depende da regra de negocio"],
            respostaCerta: 1
        },
        {
            pergunta: "O que é energia do ponto de vista da astrofísica?",
            opcoes: ["É uma constante do univeros que não diminui ou aumenta, apenas se converte", "Energia é composta por 4 grandezas, elasticidade, velocidade, aceleração e eletrostática", "Toddynho", "É o que eu uso para trabalhar"],
            respostaCerta: 0
        },
        {
            pergunta: "O que antecede o nascimento de uma estrela?",
            opcoes: ["Campo gravitico", "Nebulosa", "sei la quero joga lol", "Neutrons"],
            respostaCerta: 1
        },
        {
            pergunta: "O que tem no centro de uma galáxia?",
            opcoes: ["Domingão do faustão", "Uma estrela de neutrôns", "Uma estrela", "Um Quasar"],
            respostaCerta: 3
        },
        {
            pergunta: "Qual fenomeno físico foi importante para existência de vida na terra?",
            opcoes: [
                "A massiva movimentação de metais no centro da terra que com a eletroestática criou um campo gravitico",
                "A massiva movimentação de metais no centro da terra que com a eletroestática criou um campo estático, protegendo a terra de rajadas solares",
                "A massiva movimentação de metais no centro da terra que criou os metais necessários para composição do corpo humano",
                "Aquele bixinho que aparece nos livros de biologia"
            ],
            respostaCerta: 1
        },
    ]

    var perguntaAtual = 0;
    var pontuacao = 0;
    var idUsuario = sessionStorage.ID_USUARIO
    // script do funcionamento do QUIZ!!
    function mostrarQuiz() {
        var divPergunta = document.getElementById("pergunta");
        var divOpcoes = document.getElementById("opcoes");
        var resultado = document.getElementById("resultado");

        // essa div pega o vetor, 
        // pega a posição da pergunta, ou seja ZERO
        // (.pergunta) < elemento do vetor a ser exibido
        // ESSE CAMPO (.pergunta) ESTÁ PEGANDO O ELEMENTO PERGUNTA DENTRO DO ARRAY
        divPergunta.innerHTML = perguntas[perguntaAtual].pergunta;

        divOpcoes.innerHTML = "";

        // Loop para criar os botões de opção das respostas

        var qtdOpcoes = perguntas[perguntaAtual].opcoes.length;

        for (var i = 0; i < qtdOpcoes; i++) {
            divOpcoes.innerHTML += "<button class='option' onclick=validarResposta(" + i + ")>" + perguntas[perguntaAtual].opcoes[i] + "</button>";
        }
        resultado.innerHTML = "";
    }

    function validarResposta(opcaoSelecionada) {
        // Verificando se a resposta esta certa, ele compara a opção selecionada com a 
        // posição da resposta certa do vetor, no qual está declarado no array de questoes
        if (opcaoSelecionada == perguntas[perguntaAtual].respostaCerta) {
            pontuacao++;
        }

        perguntaAtual++; // comando para a pergunta ser trocada

        if (perguntaAtual < perguntas.length) {
            mostrarQuiz();
        } else {
            var divPergunta = document.getElementById("pergunta");
            var divOpcoes = document.getElementById("opcoes");
            var resultado = document.getElementById("resultado");
            var totalPontos = 0;
            totalPontos = pontuacao;
            console.log(totalPontos);

            divPergunta.innerHTML = "";
            divOpcoes.innerHTML = "";
            resultado.innerHTML = `Você acertou ${pontuacao} de ${perguntas.length} perguntas`;
        }
    
        var totalPontosVar = totalPontos
        var idVar = sessionStorage.ID_USUARIO
        console.log (idVar + "verificando idVar")

        if (perguntaAtual == 5){ 
            fetch("usuarios/pontuacao", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                pontuacaoServer: totalPontosVar, 
                idUsuarioServer: idVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                console.log("dados cadastrados")

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });

        return false;
    }
}    
</script>